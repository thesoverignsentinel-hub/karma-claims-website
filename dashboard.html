<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karma Claims | Active Case Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a365d; --primary-mid: #1e4080; --secondary: #2563eb; 
            --accent: #dc2626; --success: #16a34a; --warning: #d97706; 
            --bg: #f0f4f8; --surface: #ffffff; --border: #e2e8f0; 
            --text: #0f172a; --text-muted: #64748b;
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            background-image: radial-gradient(ellipse at 10% 10%, rgba(37,99,235,0.05) 0%, transparent 45%), radial-gradient(ellipse at 90% 85%, rgba(26,54,93,0.07) 0%, transparent 45%);
            color: var(--text); font-family: 'Inter', -apple-system, sans-serif; min-height: 100vh; padding-bottom: 120px;
        }

        /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
        .nav { background: var(--primary); height: 58px; display: flex; align-items: center; justify-content: space-between; padding: 0 28px; position: sticky; top: 0; z-index: 200; box-shadow: 0 2px 16px rgba(26,54,93,0.28); }
        .nav-left { display: flex; align-items: center; gap: 20px; }
        .back-nav { display: flex; align-items: center; gap: 6px; color: rgba(255,255,255,0.65); text-decoration: none; font-size: 13.5px; font-weight: 500; transition: color 0.2s; }
        .back-nav:hover { color: white; }
        .nav-divider { width: 1px; height: 18px; background: rgba(255,255,255,0.2); }
        .nav-brand { font-weight: 800; font-size: 17.5px; color: white; letter-spacing: -0.02em; }
        .nav-brand span { color: #60a5fa; }
        .nav-status { display: flex; align-items: center; gap: 7px; font-size: 12px; font-weight: 500; color: rgba(255,255,255,0.55); }
        .status-dot { width: 7px; height: 7px; background: #22c55e; border-radius: 50%; animation: pulseDot 2s ease-in-out infinite; }
        @keyframes pulseDot { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.4; transform: scale(0.75); } }

        /* ‚îÄ‚îÄ SCOREBOARD ‚îÄ‚îÄ */
        .scoreboard { background: var(--primary); background-image: linear-gradient(135deg, #1a365d 0%, #1e4080 60%, #1a3870 100%); padding: 36px 28px 32px; text-align: center; position: relative; overflow: hidden; border-bottom: 1px solid rgba(255,255,255,0.07); }
        .scoreboard::before { content: ''; position: absolute; top: -80px; left: -80px; width: 240px; height: 240px; background: radial-gradient(circle, rgba(96,165,250,0.1) 0%, transparent 70%); border-radius: 50%; pointer-events: none; }
        .scoreboard::after { content: ''; position: absolute; bottom: -50px; right: -50px; width: 180px; height: 180px; background: radial-gradient(circle, rgba(37,99,235,0.12) 0%, transparent 70%); border-radius: 50%; pointer-events: none; }
        .scoreboard-eyebrow { font-size: 10.5px; font-weight: 700; letter-spacing: 0.18em; text-transform: uppercase; color: rgba(255,255,255,0.4); margin-bottom: 10px; position: relative; z-index: 1; }
        .scoreboard-amount { font-size: clamp(38px, 8vw, 64px); font-weight: 800; color: #60a5fa; letter-spacing: -0.03em; line-height: 1; position: relative; z-index: 1; }
        .scoreboard-amount .rupee { font-size: 0.55em; vertical-align: top; margin-top: 0.15em; }
        .scoreboard-pills { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 14px; flex-wrap: wrap; position: relative; z-index: 1; }
        .s-pill { background: rgba(255,255,255,0.09); border: 1px solid rgba(255,255,255,0.14); padding: 5px 14px; border-radius: 100px; font-size: 12.5px; color: rgba(255,255,255,0.8); }
        .s-pill strong { color: #93c5fd; }

        /* ‚îÄ‚îÄ WRAPPER ‚îÄ‚îÄ */
        .wrapper { max-width: 1040px; margin: 0 auto; padding: 26px 18px; }

        /* ‚îÄ‚îÄ COMPANY SELECTOR ‚îÄ‚îÄ */
        .selector-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px 22px; margin-bottom: 22px; box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 4px 12px rgba(0,0,0,0.03); }
        .selector-top { display: flex; align-items: flex-start; gap: 14px; margin-bottom: 14px; }
        .selector-icon { width: 42px; height: 42px; background: #eff6ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .selector-label { font-weight: 700; font-size: 14.5px; color: var(--primary); margin-bottom: 3px; }
        .selector-sub { font-size: 13px; color: var(--text-muted); }

        .search-wrap { position: relative; }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 14px; pointer-events: none; }
        .company-input { width: 100%; padding: 11px 14px 11px 36px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 14.5px; font-family: 'Inter', sans-serif; color: var(--text); background: var(--bg); transition: border-color 0.2s, box-shadow 0.2s; }
        .company-input:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); background: white; }

        /* ‚îÄ‚îÄ UNVERIFIED WARNING ‚îÄ‚îÄ */
        .unverified-banner { display: none; margin-top: 12px; background: #fffbeb; border: 1px solid #fde68a; border-left: 4px solid #f59e0b; border-radius: 0 8px 8px 0; padding: 12px 14px; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
        .ub-title { font-weight: 700; font-size: 13.5px; color: #92400e; margin-bottom: 4px; }
        .unverified-banner p { font-size: 13px; color: #a16207; margin-bottom: 10px; line-height: 1.5; }
        .ub-btn { background: #b45309; color: white; border: none; padding: 7px 14px; border-radius: 6px; font-family: 'Inter', sans-serif; font-weight: 600; font-size: 12.5px; cursor: pointer; transition: background 0.2s; display: inline-flex; align-items: center; gap: 6px; width: auto; }
        .ub-btn:hover { background: #92400e; }

        /* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }

        /* ‚îÄ‚îÄ WIDGET ‚îÄ‚îÄ */
        .widget { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px 22px; box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 4px 12px rgba(0,0,0,0.03); transition: box-shadow 0.2s; }
        .widget:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.06), 0 8px 24px rgba(0,0,0,0.06); }
        .widget-header { display: flex; align-items: center; gap: 10px; padding-bottom: 14px; margin-bottom: 16px; border-bottom: 1px solid var(--border); }
        .w-icon { width: 34px; height: 34px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
        .w-icon.blue { background: #eff6ff; } .w-icon.red { background: #fef2f2; } .w-icon.green { background: #f0fdf4; } .w-icon.slate { background: #f1f5f9; }
        .w-title { font-weight: 700; font-size: 14.5px; color: var(--primary); }
        .w-badge { margin-left: auto; font-size: 10.5px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; padding: 3px 9px; border-radius: 100px; }
        .badge-blue { background: #eff6ff; color: var(--secondary); } .badge-red { background: #fef2f2; color: var(--accent); } .badge-green { background: #f0fdf4; color: var(--success); } .badge-amber { background: #fffbeb; color: #b45309; }

        /* ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ */
        .timeline-empty { text-align: center; padding: 20px 0; color: var(--text-muted); font-size: 13.5px; }
        .timeline-empty .ei { font-size: 26px; margin-bottom: 6px; }
        .deadline-row { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .deadline-row:last-of-type { border-bottom: none; }
        .ddot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; margin-top: 5px; }
        .ddot.blue { background: var(--secondary); } .ddot.orange { background: #f97316; }
        .d-label { font-size: 12px; font-weight: 500; color: var(--text-muted); margin-bottom: 2px; }
        .d-date { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 13.5px; font-weight: 600; color: var(--text); }
        .deadline-warning { background: #fffbeb; border: 1px solid #fde68a; border-radius: 8px; padding: 10px 12px; font-size: 12.5px; color: #92400e; margin-top: 12px; display: flex; align-items: flex-start; gap: 7px; line-height: 1.5; }

        .matrix-divider { font-size: 10.5px; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; color: var(--text-muted); margin: 16px 0 10px; }
        .matrix-step { display: flex; align-items: center; gap: 10px; padding: 9px 12px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 7px; font-size: 13px; color: var(--text); background: var(--bg); animation: fadeUp 0.35s ease both; }
        .matrix-step:nth-child(2) { animation-delay: 0.06s; } .matrix-step:nth-child(3) { animation-delay: 0.12s; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
        .m-num { width: 22px; height: 22px; background: var(--primary); color: white; border-radius: 50%; font-size: 10.5px; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .matrix-step a { color: var(--secondary); font-weight: 500; text-decoration: none; }
        .matrix-step a:hover { text-decoration: underline; }
        .copy-pill { margin-left: auto; background: none; border: 1px solid var(--border); color: var(--text-muted); font-size: 11.5px; font-weight: 500; padding: 2px 8px; border-radius: 4px; cursor: pointer; transition: all 0.15s; width: auto; white-space: nowrap; font-family: 'Inter', sans-serif; }
        .copy-pill:hover { background: var(--border); color: var(--text); }

        /* ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ */
        .styled-textarea { width: 100%; padding: 10px 12px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 13.5px; font-family: 'Inter', sans-serif; color: var(--text); background: var(--bg); resize: vertical; min-height: 90px; transition: border-color 0.2s, box-shadow 0.2s; line-height: 1.5; }
        .styled-textarea:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); background: white; }
        .styled-input { width: 100%; padding: 10px 12px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 14.5px; font-family: 'Inter', sans-serif; color: var(--text); background: var(--bg); transition: border-color 0.2s, box-shadow 0.2s; }
        .styled-input:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); background: white;}

        /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
        .btn { width: 100%; margin-top: 10px; padding: 11px 16px; border: none; border-radius: 8px; font-family: 'Inter', sans-serif; font-weight: 700; font-size: 13.5px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--secondary); color: white; }
        .btn-primary:hover { background: #1d4ed8; transform: translateY(-1px); box-shadow: 0 4px 14px rgba(37,99,235,0.3); }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #15803d; transform: translateY(-1px); box-shadow: 0 4px 14px rgba(22,163,74,0.3); }
        .btn:active { transform: translateY(0) !important; box-shadow: none !important; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
        .btn-spinner { display: none; width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.7s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn.loading .btn-spinner { display: block; }
        .btn.loading .btn-label { opacity: 0.75; }

        /* ‚îÄ‚îÄ RESULT BOXES ‚îÄ‚îÄ */
        .result-box { display: none; margin-top: 12px; padding: 12px 14px; border-radius: 8px; font-size: 13.5px; line-height: 1.65; animation: fadeUp 0.3s ease; }
        .rb-info { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; }
        .rb-success { background: #f0fdf4; border: 1px solid #bbf7d0; color: #166534; font-weight: 600; text-align: center; font-size: 14.5px; }

        .bs-tag { display: inline-block; font-weight: 700; font-size: 10.5px; letter-spacing: 0.1em; text-transform: uppercase; padding: 3px 9px; border-radius: 4px; margin-bottom: 8px; }
        .tag-stalling { background: #fef3c7; color: #92400e; }
        .tag-illegal { background: #fee2e2; color: #991b1b; }
        .tag-valid { background: #d1fae5; color: #065f46; }

        /* ‚îÄ‚îÄ COMING SOON ‚îÄ‚îÄ */
        .coming-soon-block { background: #f8fafc; border: 1.5px dashed var(--border); border-radius: 10px; padding: 28px 20px; text-align: center; }
        .cs-icon { font-size: 28px; margin-bottom: 10px; }
        .cs-title { font-weight: 700; font-size: 15.5px; color: var(--primary); margin-bottom: 6px; }
        .cs-sub { font-size: 13px; color: var(--text-muted); line-height: 1.6; max-width: 280px; margin: 0 auto; }
        .cs-eta { display: inline-block; margin-top: 12px; background: #f1f5f9; border: 1px solid var(--border); padding: 4px 12px; border-radius: 100px; font-size: 11.5px; font-weight: 600; color: var(--text-muted); }

        /* ‚îÄ‚îÄ WIN WIDGET ‚îÄ‚îÄ */
        .win-inputs { display: flex; flex-direction: column; gap: 8px; margin-bottom: 2px; }
        .amount-wrap { position: relative; }
        .amount-prefix { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-family: ui-monospace, SFMono-Regular, monospace; font-size: 14.5px; color: var(--text-muted); pointer-events: none; }
        .amount-wrap .styled-input { padding-left: 26px; font-family: ui-monospace, SFMono-Regular, monospace;}

        .file-drop { border: 1.5px dashed #93c5fd; background: #eff6ff; border-radius: 8px; padding: 14px; text-align: center; cursor: pointer; transition: background 0.2s, border-color 0.2s; position: relative; }
        .file-drop:hover { background: #dbeafe; border-color: var(--secondary); }
        .file-drop input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
        .file-drop-icon { font-size: 18px; margin-bottom: 3px; }
        .file-drop-text { font-size: 12.5px; color: var(--secondary); font-weight: 600; }
        .file-drop-sub { font-size: 11.5px; color: var(--text-muted); margin-top: 2px; }
        .file-name { font-size: 12.5px; color: var(--success); font-weight: 500; margin-top: 4px; display: none; }

        /* ‚îÄ‚îÄ TIP JAR ‚îÄ‚îÄ */
        .tip-jar { display: none; margin-top: 16px; background: #fef2f2; border: 2px dashed #fca5a5; border-radius: 12px; padding: 20px; text-align: center; animation: fadeUp 0.4s ease; }
        .tip-title { font-weight: 800; font-size: 15.5px; color: #b91c1c; margin-bottom: 6px; }
        .tip-sub { font-size: 13px; color: #64748b; line-height: 1.55; margin-bottom: 14px; }
        .tip-jar img { width: 148px; height: 148px; border-radius: 10px; box-shadow: 0 4px 16px rgba(0,0,0,0.12); display: block; margin: 0 auto 10px; }
        .tip-upi { font-family: ui-monospace, SFMono-Regular, monospace; font-size: 13.5px; font-weight: 500; color: var(--primary); background: white; border: 1px solid var(--border); padding: 6px 14px; border-radius: 6px; display: inline-block; }

        /* ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ */
        #chat-toggle { position: fixed; bottom: 24px; right: 24px; background: var(--primary); color: white; width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 8px 24px rgba(26,54,93,0.4); font-size: 22px; z-index: 1999; border: none; transition: transform 0.2s, box-shadow 0.2s; }
        #chat-toggle:hover { transform: scale(1.08); box-shadow: 0 12px 32px rgba(26,54,93,0.5); }
        #chat-widget { position: fixed; bottom: 92px; right: 24px; width: 336px; background: white; border: 1px solid var(--border); border-radius: 16px; box-shadow: 0 20px 48px rgba(0,0,0,0.13); display: none; flex-direction: column; z-index: 2000; overflow: hidden; animation: chatPop 0.25s cubic-bezier(0.34, 1.56, 0.64, 1); }
        @keyframes chatPop { from { opacity: 0; transform: scale(0.9) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        #chat-header { background: var(--primary); padding: 13px 15px; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .ch-avatar { width: 30px; height: 30px; background: rgba(96,165,250,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .ch-name { font-weight: 700; font-size: 13.5px; color: white; }
        .ch-sub { font-size: 10.5px; color: rgba(255,255,255,0.5); display: flex; align-items: center; gap: 4px; }
        .ch-sub-dot { width: 5px; height: 5px; background: #22c55e; border-radius: 50%; }
        .ch-close { margin-left: auto; color: rgba(255,255,255,0.5); font-size: 18px; line-height: 1; }
        #chat-body { height: 255px; overflow-y: auto; padding: 12px; background: #f8fafc; display: flex; flex-direction: column; gap: 8px; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
        .bot-msg, .user-msg { padding: 9px 12px; border-radius: 10px; max-width: 88%; font-size: 13.5px; line-height: 1.5; animation: fadeUp 0.2s ease; }
        .bot-msg { background: white; border: 1px solid var(--border); color: #334155; align-self: flex-start; border-bottom-left-radius: 3px; }
        .user-msg { background: var(--secondary); color: white; align-self: flex-end; border-bottom-right-radius: 3px; }

        .typing-indicator { display: flex; gap: 4px; padding: 10px 13px; background: white; border: 1px solid var(--border); border-radius: 10px; border-bottom-left-radius: 3px; width: fit-content; align-self: flex-start; }
        .t-dot { width: 6px; height: 6px; background: var(--text-muted); border-radius: 50%; animation: typeBounce 1.2s ease-in-out infinite; }
        .t-dot:nth-child(2) { animation-delay: 0.2s; } .t-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typeBounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-5px); } }

        #chat-input-area { border-top: 1px solid var(--border); padding: 10px 12px; display: flex; gap: 8px; background: white; }
        #chat-input { flex: 1; padding: 8px 12px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 13.5px; font-family: 'Inter', sans-serif; transition: border-color 0.2s; }
        #chat-input:focus { outline: none; border-color: var(--secondary); }
        #chat-send { background: var(--secondary); color: white; border: none; padding: 8px 14px; border-radius: 8px; font-weight: 700; font-size: 13.5px; cursor: pointer; transition: background 0.2s; width: auto; }
        #chat-send:hover { background: #1d4ed8; }

        /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
        .toast { position: fixed; top: 72px; right: 20px; background: var(--primary); color: white; padding: 11px 16px; border-radius: 10px; font-weight: 600; font-size: 13.5px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); z-index: 9999; display: flex; align-items: center; gap: 8px; animation: toastIn 0.3s ease; }
        @keyframes toastIn { from { opacity: 0; transform: translateX(16px); } to { opacity: 1; transform: translateX(0); } }
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9998; }

        @media (max-width: 640px) { .nav { padding: 0 16px; } .wrapper { padding: 14px 12px; } #chat-widget { width: calc(100vw - 28px); right: 14px; } }
    </style>
</head>
<body>

<nav class="nav">
    <div class="nav-left">
        <a href="index.html" class="back-nav">‚Üê Generator</a>
        <div class="nav-divider"></div>
        <div class="nav-brand">Karma<span>Claims</span></div>
    </div>
    <div class="nav-status">
        <div class="status-dot"></div>
        v4.1 Online
    </div>
</nav>

<div class="scoreboard">
    <div class="scoreboard-eyebrow">Karma Community ‚Äî Total Recovered</div>
    <div class="scoreboard-amount">
        <span class="rupee">‚Çπ</span><span id="total_recovered">‚Äî</span>
    </div>
    <div class="scoreboard-pills">
        <div class="s-pill"><strong id="cases_won">‚Äî</strong> Cases Won</div>
        <div class="s-pill"><strong id="active_users">‚Äî</strong> Active Today</div>
    </div>
</div>

<div class="wrapper">

    <div class="selector-card">
        <div class="selector-top">
            <div class="selector-icon">‚öñÔ∏è</div>
            <div>
                <div class="selector-label">Select Your Active Case</div>
                <div class="selector-sub">Search our verified database or type any company name to proceed</div>
            </div>
        </div>
        <div class="search-wrap">
            <span class="search-icon">üîç</span>
            <input
                list="company_list"
                id="case_company"
                class="company-input"
                placeholder="Start typing ‚Äî e.g. Zomato, PhonePe, HDFC Bank..."
                oninput="onCompanyInput()"
                onchange="loadTimelineAndMatrix()"
                autocomplete="off"
            >
            <datalist id="company_list">
                <option value="Amazon India (Amazon Seller Services Pvt Ltd)"><option value="Flipkart (Flipkart Internet Pvt Ltd)"><option value="Myntra (Myntra Designs Pvt Ltd)"><option value="Meesho (Fashnear Technologies Pvt Ltd)"><option value="Swiggy (Bundl Technologies Pvt Ltd)"><option value="Zomato (Zomato Ltd)"><option value="Blinkit (Blink Commerce Pvt Ltd)"><option value="Zepto (Kiranakart Technologies Pvt Ltd)"><option value="Nykaa (FSN E-Commerce Ventures)">
                <option value="Google Pay (Google India Digital Services)"><option value="PhonePe (PhonePe Pvt Ltd)"><option value="Paytm (One97 Communications Ltd)"><option value="CRED (Dreamplug Technologies Pvt Ltd)"><option value="BharatPe (Resilient Innovations Pvt Ltd)"><option value="HDFC Bank (HDFC Bank Limited)"><option value="SBI (State Bank of India)"><option value="ICICI Bank (ICICI Bank Limited)"><option value="Axis Bank (Axis Bank Limited)">
                <option value="Ola Cabs (ANI Technologies Pvt Ltd)"><option value="Uber India (Uber India Systems Pvt Ltd)"><option value="Rapido (Roppen Transportation Services)"><option value="MakeMyTrip (MakeMyTrip India Pvt Ltd)">
                <option value="Reliance Jio (Reliance Jio Infocomm Ltd)"><option value="Bharti Airtel (Bharti Airtel Ltd)"><option value="Vodafone Idea (Vi)">
                <option value="Byju's (Think & Learn Pvt Ltd)"><option value="Unacademy (Sorting Hat Technologies)"><option value="PhysicsWallah">
            </datalist>
        </div>

        <div class="unverified-banner" id="unverified_banner">
            <div class="ub-title">‚ö†Ô∏è Unverified Company</div>
            <p>This company isn't in our verified database yet. We'll apply generic CCPA timelines ‚Äî you can still proceed, or request fast-track verification below.</p>
            <button class="ub-btn" onclick="requestVerification()">
                üìß Request Verification (24hr SLA)
            </button>
        </div>
    </div>

    <div class="grid-2">

        <div class="widget">
            <div class="widget-header">
                <div class="w-icon blue">‚è≥</div>
                <div class="w-title">Timeline & Escalation Matrix</div>
                <span class="w-badge badge-blue" id="reg_badge" style="display:none">RBI</span>
            </div>
            <div id="timeline_content">
                <div class="timeline-empty">
                    <div class="ei">üìã</div>
                    Select a company above to calculate your legal deadlines
                </div>
            </div>
            <div id="matrix_section" style="display:none">
                <div class="matrix-divider">‚ö° Attack Vectors</div>
                <div id="matrix_steps"></div>
            </div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <div class="w-icon red">üïµÔ∏è</div>
                <div class="w-title">Corporate BS Detector</div>
                <span class="w-badge badge-red">AI</span>
            </div>
            <p style="font-size:12.5px;color:var(--text-muted);margin-bottom:10px;">Paste their confusing reply. AI decodes stalling tactics instantly.</p>
            <textarea class="styled-textarea" id="bs_input" placeholder="e.g., 'Please provide a Level 2 authorization ID to proceed with your refund request...'"></textarea>
            <button class="btn btn-primary" id="bs_btn" onclick="detectBS()">
                <span class="btn-spinner"></span>
                <span class="btn-label">üîç Analyze Email</span>
            </button>
            <div class="result-box rb-info" id="bs_result"></div>
        </div>

    </div>

    <div class="grid-2">

        <div class="widget">
            <div class="widget-header">
                <div class="w-icon slate">‚öñÔ∏è</div>
                <div class="w-title">Gov e-Daakhil Integration</div>
                <span class="w-badge badge-amber">Soon</span>
            </div>
            <div class="coming-soon-block">
                <div class="cs-icon">üöÄ</div>
                <div class="cs-title">Direct Portal Integration</div>
                <p class="cs-sub">We're building a direct bridge to the Government e-Daakhil portal ‚Äî auto-generate legal PDFs and pre-fill your complaint with zero manual work.</p>
                <div class="cs-eta">üóì Unlocks Next Month</div>
            </div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <div class="w-icon green">üèÜ</div>
                <div class="w-title">Case Closed ‚Äî Log Your Win</div>
                <span class="w-badge badge-green">Victory</span>
            </div>
            <p style="font-size:12.5px;color:var(--text-muted);margin-bottom:12px;">Did our notice force a refund? Log your win and update the community scoreboard!</p>

            <div class="win-inputs">
                <div class="amount-wrap">
                    <span class="amount-prefix">‚Çπ</span>
                    <input type="number" class="styled-input" id="win_amount" placeholder="Amount Recovered">
                </div>
                <div class="file-drop">
                    <input type="file" id="win_screenshot" accept="image/png,image/jpeg" onchange="onFileSelected(this)">
                    <div class="file-drop-icon">üìé</div>
                    <div class="file-drop-text">Attach Proof (Optional)</div>
                    <div class="file-drop-sub">PNG or JPG screenshot of your refund</div>
                    <div class="file-name" id="file_name_display"></div>
                </div>
            </div>

            <button class="btn btn-success" id="win_btn" onclick="reportWin()">
                <span class="btn-spinner"></span>
                <span class="btn-label">üéâ I Got My Refund!</span>
            </button>

            <div class="result-box rb-success" id="win_result"></div>

            <div class="tip-jar" id="tip_jar">
                <div class="tip-title">‚òï Support Karma Claims</div>
                <p class="tip-sub">Built by a solo founder. If we helped you recover your money, consider buying us a coffee via UPI!</p>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi%3A%2F%2Fpay%3Fpa%3Dss.aggarwal.17%40okaxis%26pn%3DKarma%2520Claims" alt="UPI QR Code">
                <div class="tip-upi">ss.aggarwal.17@okaxis</div>
            </div>
        </div>

    </div>
</div>

<button id="chat-toggle" onclick="toggleChat()" title="Karma AI Strategist">üí¨</button>

<div id="chat-widget">
    <div id="chat-header" onclick="toggleChat()">
        <div class="ch-avatar">‚öñÔ∏è</div>
        <div>
            <div class="ch-name">Karma AI Strategist</div>
            <div class="ch-sub"><span class="ch-sub-dot"></span> Online ‚Äî Ready to fight</div>
        </div>
        <span class="ch-close">√ó</span>
    </div>
    <div id="chat-body">
        <div class="bot-msg">Hi! I'm your legal strategist. What hurdle is the company throwing at you today?</div>
    </div>
    <div id="chat-input-area">
        <input type="text" id="chat-input" placeholder="Ask me anything..." onkeydown="if(event.key==='Enter') sendToChat()">
        <button id="chat-send" onclick="sendToChat()">‚Üë</button>
    </div>
</div>

<canvas id="confetti-canvas"></canvas>

<script>
    const API_BASE = "https://karma-claims-backend.onrender.com";

    // ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
    function toast(msg, icon = '‚úì') {
        const t = document.createElement('div');
        t.className = 'toast'; t.innerHTML = `<span>${icon}</span> ${msg}`;
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 3000);
    }

    function copyText(text, label = 'Copied!') {
        navigator.clipboard.writeText(text).then(() => toast(label, 'üìã'));
    }

    function setLoading(id, on) {
        const el = document.getElementById(id);
        if (!el) return;
        el.disabled = on;
        el.classList.toggle('loading', on);
    }

    function showResult(id, html, cls = 'rb-info') {
        const el = document.getElementById(id);
        el.className = `result-box ${cls}`;
        el.innerHTML = html;
        el.style.display = 'block';
    }

    function animateNum(id, to, ms = 1600) {
        const el = document.getElementById(id);
        if (!el) return;
        const start = performance.now();
        (function tick(now) {
            const p = Math.min((now - start) / ms, 1);
            const eased = 1 - Math.pow(1 - p, 3);
            el.innerText = Math.round(to * eased).toLocaleString('en-IN');
            if (p < 1) requestAnimationFrame(tick);
        })(start);
    }

    // ‚îÄ‚îÄ DASHBOARD LOAD ‚îÄ‚îÄ
    async function loadDashboard() {
        try {
            const res = await fetch(`${API_BASE}/api/dashboard`);
            if (!res.ok) return;
            const d = await res.json();
            animateNum('total_recovered', d.total_recovered, 1800);
            animateNum('cases_won', d.cases_won, 1400);
            animateNum('active_users', d.active_users, 1600);
        } catch (e) { console.error('Scoreboard offline'); }
    }

    // ‚îÄ‚îÄ COMPANY INPUT ‚îÄ‚îÄ
    function onCompanyInput() {
        document.getElementById('unverified_banner').style.display = 'none';
    }

    // ‚îÄ‚îÄ TIMELINE + MATRIX ‚îÄ‚îÄ
    async function loadTimelineAndMatrix() {
        const company = document.getElementById('case_company').value.trim();
        if (!company) return;

        const tc = document.getElementById('timeline_content');
        const ms = document.getElementById('matrix_section');
        const mSteps = document.getElementById('matrix_steps');
        const badge = document.getElementById('reg_badge');
        const banner = document.getElementById('unverified_banner');

        tc.innerHTML = `<div class="timeline-empty"><div class="ei">‚è≥</div>Loading your deadlines...</div>`;
        ms.style.display = 'none';

        try {
            const [resT, resM] = await Promise.all([
                fetch(`${API_BASE}/api/timeline/${encodeURIComponent(company)}`),
                fetch(`${API_BASE}/api/matrix/${encodeURIComponent(company)}`)
            ]);

            if (resT.ok) {
                const d = await resT.json();
                const isRBI = !!d.ombudsman_escalation_date;
                const escalLabel = isRBI ? 'RBI Ombudsman Date' : 'Consumer Court Date';
                const escalDate = d.ombudsman_escalation_date || d.consumer_court_date;

                badge.innerText = isRBI ? 'RBI' : 'CCPA';
                badge.style.display = 'inline-block';
                banner.style.display = d.unverified ? 'block' : 'none';

                tc.innerHTML = `
                    <div class="deadline-row">
                        <div class="ddot blue"></div>
                        <div>
                            <div class="d-label">Level 1 Response Deadline</div>
                            <div class="d-date">${d.level_1_deadline}</div>
                        </div>
                    </div>
                    <div class="deadline-row">
                        <div class="ddot orange"></div>
                        <div>
                            <div class="d-label">${escalLabel}</div>
                            <div class="d-date">${escalDate}</div>
                        </div>
                    </div>
                    <div class="deadline-warning">‚ö†Ô∏è ${d.warning}</div>
                `;
            }

            if (resM.ok) {
                const dm = await resM.json();
                ms.style.display = 'block';
                const isURL = dm.step_3_portal && dm.step_3_portal.startsWith('http');
                const email = dm.step_1_email;
                const hasEmail = email && email.includes('@');
                mSteps.innerHTML = `
                    <div class="matrix-step">
                        <div class="m-num">1</div>
                        üìß <span style="flex:1;word-break:break-all;">${email}</span>
                        ${hasEmail ? `<button class="copy-pill" onclick="copyText('${email}', 'Email copied!')">Copy</button>` : ''}
                    </div>
                    <div class="matrix-step">
                        <div class="m-num">2</div>
                        üì£ <span>${dm.step_2_social_pressure}</span>
                    </div>
                    <div class="matrix-step">
                        <div class="m-num">3</div>
                        üåê ${isURL ? `<a href="${dm.step_3_portal}" target="_blank" rel="noopener">Official Portal ‚Üó</a>` : `<span>${dm.step_3_portal}</span>`}
                    </div>
                `;
            }
        } catch (e) {
            tc.innerHTML = `<div class="timeline-empty">‚ö†Ô∏è Could not load case data. Check connection.</div>`;
        }
    }

    // ‚îÄ‚îÄ VERIFICATION REQUEST ‚îÄ‚îÄ
    function requestVerification() {
        const company = document.getElementById('case_company').value.trim();
        const sub = encodeURIComponent(`URGENT: Karma Claims DB Addition ‚Äî ${company}`);
        const body = encodeURIComponent(`Hi,\n\nPlease verify and add Nodal Officer details for:\n\nCompany: ${company}\n\nI need to escalate my claim urgently.\n\nThank you.`);
        window.location.href = `mailto:thesoverignsentinel@gmail.com?subject=${sub}&body=${body}`;
    }

    // ‚îÄ‚îÄ BS DETECTOR ‚îÄ‚îÄ
    async function detectBS() {
        const input = document.getElementById('bs_input').value.trim();
        if (!input) { toast('Paste a corporate email first', '‚ö†Ô∏è'); return; }

        setLoading('bs_btn', true);
        try {
            const res = await fetch(`${API_BASE}/api/detect-bs`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ corporate_reply: input })
            });
            const d = await res.json();
            const text = d.analysis || '';
            let tagClass = 'tag-stalling', tagLabel = 'Stalling Tactic';
            if (text.toLowerCase().includes('illegal')) { tagClass = 'tag-illegal'; tagLabel = 'Illegal Demand'; }
            else if (text.toLowerCase().includes('valid request')) { tagClass = 'tag-valid'; tagLabel = 'Valid Request'; }
            showResult('bs_result', `<span class="bs-tag ${tagClass}">${tagLabel}</span><br>${text}`, 'rb-info');
        } catch (e) {
            showResult('bs_result', '‚ö†Ô∏è AI Detector is temporarily offline.', 'rb-info');
        }
        setLoading('bs_btn', false);
    }

    // ‚îÄ‚îÄ FILE SELECTED ‚îÄ‚îÄ
    function onFileSelected(input) {
        const nameEl = document.getElementById('file_name_display');
        if (input.files.length > 0) {
            nameEl.innerText = '‚úì ' + input.files[0].name;
            nameEl.style.display = 'block';
        }
    }

    // ‚îÄ‚îÄ REPORT WIN ‚îÄ‚îÄ
    async function reportWin() {
        const amount = parseFloat(document.getElementById('win_amount').value);
        const company = document.getElementById('case_company').value.trim();
        const hasFile = document.getElementById('win_screenshot').files.length > 0;

        if (!amount || amount <= 0) { toast('Enter the amount you recovered', '‚ö†Ô∏è'); return; }
        if (!company) { toast('Select a company at the top first', '‚ö†Ô∏è'); return; }

        setLoading('win_btn', true);
        try {
            const res = await fetch(`${API_BASE}/api/report-outcome`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ amount_recovered: amount, company_name: company, has_screenshot: hasFile })
            });
            const d = await res.json();
            showResult('win_result', `üéâ BOOM! You beat ${company}. The community scoreboard has been updated!`, 'rb-success');
            if (d.new_total) animateNum('total_recovered', d.new_total, 1200);
            document.getElementById('tip_jar').style.display = 'block';
            document.getElementById('win_btn').style.display = 'none';
            launchConfetti();
        } catch (e) {
            toast('Error reporting. Please try again.', '‚ö†Ô∏è');
            setLoading('win_btn', false);
        }
    }

    // ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ
    function launchConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const colors = ['#2563eb','#1a365d','#16a34a','#60a5fa','#fbbf24','#f97316','#dc2626'];
        const pieces = Array.from({ length: 130 }, () => ({
            x: Math.random() * canvas.width, y: -15 - Math.random() * 30,
            r: 4 + Math.random() * 5, d: 2.5 + Math.random() * 4,
            color: colors[Math.floor(Math.random() * colors.length)],
            tilt: 0, tAngle: Math.random() * Math.PI * 2, tSpeed: 0.08 + Math.random() * 0.1
        }));
        let frame = 0;
        (function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            pieces.forEach(p => {
                p.tAngle += p.tSpeed;
                p.y += p.d;
                p.tilt = Math.sin(p.tAngle) * 12;
                ctx.beginPath();
                ctx.lineWidth = p.r;
                ctx.strokeStyle = p.color;
                ctx.moveTo(p.x + p.tilt + p.r / 2, p.y);
                ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 2);
                ctx.stroke();
            });
            if (++frame < 220) requestAnimationFrame(draw);
            else ctx.clearRect(0, 0, canvas.width, canvas.height);
        })();
    }

    // ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ
    let chatOpen = false;
    function toggleChat() {
        chatOpen = !chatOpen;
        const w = document.getElementById('chat-widget');
        w.style.display = chatOpen ? 'flex' : 'none';
        if (chatOpen) document.getElementById('chat-input').focus();
    }

    async function sendToChat() {
        const input = document.getElementById('chat-input');
        const body = document.getElementById('chat-body');
        const msg = input.value.trim();
        if (!msg) return;

        body.innerHTML += `<div class="user-msg">${msg}</div>`;
        input.value = '';
        body.scrollTop = body.scrollHeight;

        const tid = 'typ-' + Date.now();
        body.innerHTML += `<div class="typing-indicator" id="${tid}"><div class="t-dot"></div><div class="t-dot"></div><div class="t-dot"></div></div>`;
        body.scrollTop = body.scrollHeight;

        try {
            const res = await fetch(`${API_BASE}/api/chat`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_message: msg })
            });
            const d = await res.json();
            document.getElementById(tid)?.remove();
            body.innerHTML += `<div class="bot-msg">${d.reply}</div>`;
        } catch (e) {
            document.getElementById(tid)?.remove();
            body.innerHTML += `<div class="bot-msg" style="color:#dc2626">‚ö†Ô∏è Strategist is offline right now.</div>`;
        }
        body.scrollTop = body.scrollHeight;
    }

    window.onload = loadDashboard;
</script>
</body>
</html>