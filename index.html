<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karma Claims | Demand Corporate Accountability</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a365d; --secondary: #2563eb; --accent: #dc2626; 
            --success: #16a34a; --bg: #f0f4f8; --surface: #ffffff; 
            --border: #e2e8f0; --text: #0f172a; --text-muted: #64748b;
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            background-image: radial-gradient(ellipse at 10% 10%, rgba(37,99,235,0.05) 0%, transparent 45%), radial-gradient(ellipse at 90% 85%, rgba(26,54,93,0.07) 0%, transparent 45%);
            color: var(--text); font-family: 'Inter', -apple-system, sans-serif; min-height: 100vh; display: flex; flex-direction: column;
        }

        /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
        .nav { background: var(--primary); height: 58px; display: flex; align-items: center; justify-content: space-between; padding: 0 28px; position: sticky; top: 0; z-index: 200; box-shadow: 0 2px 16px rgba(26,54,93,0.28); }
        .nav-brand { font-weight: 800; font-size: 18px; color: white; letter-spacing: -0.02em; }
        .nav-brand span { color: #60a5fa; }
        .nav-link { color: rgba(255,255,255,0.8); text-decoration: none; font-size: 13.5px; font-weight: 600; transition: color 0.2s; display: flex; align-items: center; gap: 6px; }
        .nav-link:hover { color: white; }

        /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
        .hero { text-align: center; padding: 50px 20px 30px; }
        .hero h1 { font-weight: 800; font-size: clamp(32px, 5vw, 48px); color: var(--primary); letter-spacing: -0.03em; margin-bottom: 12px; line-height: 1.1; }
        .hero p { font-size: 16px; color: var(--text-muted); max-width: 500px; margin: 0 auto; line-height: 1.5; }

        .wrapper { max-width: 800px; margin: 0 auto; padding: 0 20px; flex: 1; }

        /* ‚îÄ‚îÄ GENERATOR CARD ‚îÄ‚îÄ */
        .card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 32px; box-shadow: 0 10px 30px rgba(0,0,0,0.04); margin-bottom: 40px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
        .full-width { grid-column: 1 / -1; }

        .input-group label { display: block; font-weight: 700; font-size: 13.5px; color: var(--primary); margin-bottom: 6px; }
        .styled-input, .styled-textarea { width: 100%; padding: 12px 14px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif; color: var(--text); background: #f8fafc; transition: all 0.2s; }
        .styled-input:focus, .styled-textarea:focus { outline: none; border-color: var(--secondary); background: white; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        .styled-textarea { resize: vertical; min-height: 100px; line-height: 1.5; }

        .company-error { display: none; font-size: 13px; color: var(--accent); margin-top: 8px; font-weight: 600; }

        /* ‚îÄ‚îÄ CONSENT BOX ‚îÄ‚îÄ */
        .consent-box { background: #eff6ff; border: 1px solid #bfdbfe; padding: 14px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: flex-start; gap: 10px; font-size: 13px; color: #1e40af; line-height: 1.5; }
        .consent-box input[type="checkbox"] { margin-top: 3px; width: 18px; height: 18px; cursor: pointer; accent-color: var(--secondary); }
        .consent-box a { color: var(--secondary); font-weight: 700; text-decoration: underline; cursor: pointer; }

        /* ‚îÄ‚îÄ BUTTON ‚îÄ‚îÄ */
        .btn-generate { background: var(--primary); color: white; width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: 700; font-size: 15px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-generate:hover { background: var(--secondary); transform: translateY(-2px); box-shadow: 0 8px 20px rgba(37,99,235,0.25); }
        .btn-generate:disabled { opacity: 0.7; cursor: not-allowed; transform: none; box-shadow: none; }
        .spinner { display: none; width: 16px; height: 16px; border: 2.5px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ‚îÄ‚îÄ RESULT AREA ‚îÄ‚îÄ */
        #result_section { display: none; animation: fadeUp 0.4s ease; margin-top: 30px; border-top: 2px solid var(--border); padding-top: 30px;}
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .result-grid { display: grid; grid-template-columns: 1fr 240px; gap: 24px; align-items: start; margin-top: 15px; }

        .target-box { background: #eff6ff; border: 1px solid #bfdbfe; padding: 16px; border-radius: 10px; margin-bottom: 16px; display: flex; flex-direction: column; gap: 8px; }
        .target-info { font-size: 13.5px; color: #1e40af; }
        .target-info strong { font-family: ui-monospace, monospace; font-size: 14.5px; color: var(--primary); }

        .proof-warning { background: #fffbeb; border-left: 4px solid #f59e0b; padding: 12px; margin-bottom: 16px; font-size: 13.5px; color: #92400e; border-radius: 0 8px 8px 0; font-weight: 600; line-height: 1.5; }
        
        .draft-box { background: #f8fafc; border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 20px; font-family: ui-monospace, monospace; font-size: 13px; line-height: 1.6; color: var(--text); white-space: pre-wrap; height: 320px; overflow-y: auto; }

        /* ‚îÄ‚îÄ DONATION BOX ‚îÄ‚îÄ */
        .fund-card { border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center; background: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        .fund-card h3 { color: #b91c1c; font-size: 15px; margin-bottom: 8px; font-weight: 800; }
        .fund-card p { font-size: 12.5px; color: var(--text-muted); margin-bottom: 16px; line-height: 1.5; }
        .fund-qr { width: 100%; max-width: 140px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);}
        .fund-upi { font-family: ui-monospace, monospace; font-size: 12px; font-weight: 600; color: var(--primary); background: #f1f5f9; padding: 4px 8px; border-radius: 4px; display: inline-block;}

        /* ‚îÄ‚îÄ 4 BOXES MAILING SYSTEM ‚îÄ‚îÄ */
        .mail-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 16px; }
        .mail-btn { padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: white; font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; color: var(--text);}
        .mail-btn:hover { background: #f1f5f9; border-color: #cbd5e1; transform: translateY(-1px); box-shadow: 0 4px 6px rgba(0,0,0,0.02);}
        .mail-btn.gmail { color: #ea4335; }
        .mail-btn.outlook { color: #0078d4; }
        .mail-btn.yahoo { color: #720e9e; }
        .mail-btn.apple { color: #000000; }

        .copy-btn { width: 100%; padding: 12px; background: transparent; border: 1px solid var(--border); color: var(--text); border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; transition: background 0.2s; }
        .copy-btn:hover { background: #f1f5f9; }

        /* ‚îÄ‚îÄ DASHBOARD BRIDGE ‚îÄ‚îÄ */
        .dashboard-bridge { text-align: center; margin-top: 20px; margin-bottom: 50px; }
        .dashboard-bridge a { display: inline-flex; align-items: center; gap: 8px; background: white; border: 2px solid var(--border); color: var(--primary); padding: 14px 28px; border-radius: 100px; text-decoration: none; font-weight: 700; font-size: 15px; transition: all 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .dashboard-bridge a:hover { border-color: var(--secondary); color: var(--secondary); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(37,99,235,0.1); }

        /* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 9999; }
        .modal-content { background: white; width: 90%; max-width: 500px; border-radius: 12px; padding: 24px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); position: relative; }
        .modal-close { position: absolute; top: 16px; right: 20px; font-size: 24px; cursor: pointer; color: var(--text-muted); border: none; background: none; line-height: 1;}
        .modal-close:hover { color: var(--accent); }
        .modal-title { font-weight: 800; color: var(--primary); font-size: 18px; margin-bottom: 16px; border-bottom: 1px solid var(--border); padding-bottom: 10px;}
        .modal-text { font-size: 13.5px; color: var(--text); line-height: 1.6; max-height: 60vh; overflow-y: auto;}

        /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
        .footer { background: var(--primary); color: white; padding: 40px 20px; margin-top: auto; text-align: center; }
        .footer-links { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .footer-links a { color: rgba(255,255,255,0.8); text-decoration: none; font-size: 14px; font-weight: 500; transition: color 0.2s; cursor: pointer; }
        .footer-links a:hover { color: white; text-decoration: underline; }
        .footer-text { font-size: 12.5px; color: rgba(255,255,255,0.5); line-height: 1.5;}

        @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } .mail-grid{ grid-template-columns: 1fr;} .result-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<nav class="nav">
    <div class="nav-brand">Karma<span>Claims</span></div>
    <a href="dashboard.html" class="nav-link">üìä Mission Control</a>
</nav>

<div class="hero">
    <h1>Hold Corporations Accountable. Legally.</h1>
    <p>AI generates a fierce, legally-sound grievance notice tailored to Indian consumer laws in seconds.</p>
</div>

<div class="wrapper">
    <div class="card">
        <div class="form-grid">
            <div class="input-group">
                <label>Your Name</label>
                <input type="text" id="user_name" class="styled-input" placeholder="e.g. Rahul Sharma" required>
            </div>
            <div class="input-group">
                <label>Your Email</label>
                <input type="email" id="user_email" class="styled-input" placeholder="rahul@example.com" required>
            </div>
            <div class="input-group">
                <label>Phone Number</label>
                <input type="tel" id="user_phone" class="styled-input" placeholder="+91 9876543210" required>
            </div>
            <div class="input-group">
                <label>Order / Transaction ID</label>
                <input type="text" id="order_id" class="styled-input" placeholder="e.g. ODR-12345" required>
            </div>
            
            <div class="input-group full-width">
                <label>Target Company</label>
                <input list="company_db" id="target_company" class="styled-input" placeholder="Search (e.g. Swiggy, HDFC Bank...)" autocomplete="off" required>
                <datalist id="company_db">
                    <option value="Amazon India (Amazon Seller Services Pvt Ltd)"><option value="Flipkart (Flipkart Internet Pvt Ltd)"><option value="Myntra (Myntra Designs Pvt Ltd)"><option value="Meesho (Fashnear Technologies Pvt Ltd)"><option value="Nykaa (FSN E-Commerce Ventures)"><option value="Ajio (Reliance Retail Ltd)"><option value="Tata CLiQ (Tata UniStore Ltd)"><option value="Snapdeal (Snapdeal Pvt Ltd)"><option value="Swiggy (Bundl Technologies Pvt Ltd)"><option value="Zomato (Zomato Ltd)"><option value="Blinkit (Blink Commerce Pvt Ltd)"><option value="Zepto (Kiranakart Technologies Pvt Ltd)"><option value="BigBasket (Supermarket Grocery Supplies)"><option value="JioMart (Reliance Retail Ltd)"><option value="Licious (Delightful Gourmet Pvt Ltd)">
                    <option value="Google Pay (Google India Digital Services)"><option value="PhonePe (PhonePe Pvt Ltd)"><option value="Paytm (One97 Communications Ltd)"><option value="CRED (Dreamplug Technologies Pvt Ltd)"><option value="BharatPe (Resilient Innovations Pvt Ltd)"><option value="MobiKwik (One MobiKwik Systems Ltd)"><option value="Freecharge (Freecharge Payment Technologies)"><option value="Amazon Pay (Amazon Pay India Pvt Ltd)"><option value="Slice (Garagepreneurs Internet Pvt Ltd)"><option value="Jupiter (Amica Financial Technologies)">
                    <option value="HDFC Bank (HDFC Bank Limited)"><option value="SBI (State Bank of India)"><option value="ICICI Bank (ICICI Bank Limited)"><option value="Axis Bank (Axis Bank Limited)"><option value="Kotak Mahindra Bank (Kotak Mahindra Bank Ltd)"><option value="Punjab National Bank (PNB)"><option value="Bank of Baroda (BoB)"><option value="IndusInd Bank (IndusInd Bank Limited)"><option value="IDFC First Bank (IDFC FIRST Bank Ltd)"><option value="Yes Bank (YES BANK Limited)">
                    <option value="Ola Cabs (ANI Technologies Pvt Ltd)"><option value="Uber India (Uber India Systems Pvt Ltd)"><option value="Rapido (Roppen Transportation Services)"><option value="MakeMyTrip (MakeMyTrip India Pvt Ltd)"><option value="Goibibo (Ibibo Group Pvt Ltd)"><option value="EaseMyTrip (Easy Trip Planners Ltd)"><option value="Yatra (Yatra Online Ltd)"><option value="Cleartrip (Cleartrip Pvt Ltd)"><option value="RedBus (Ibibo Group Pvt Ltd)"><option value="IRCTC (Indian Railway Catering and Tourism Corp)">
                    <option value="Reliance Jio (Reliance Jio Infocomm Ltd)"><option value="Bharti Airtel (Bharti Airtel Ltd)"><option value="Vodafone Idea (Vi)"><option value="BSNL (Bharat Sanchar Nigam Limited)"><option value="ACT Fibernet (Atria Convergence Technologies)"><option value="Hathway (Hathway Cable & Datacom Ltd)"><option value="Excitel (Excitel Broadband Pvt Ltd)">
                    <option value="Byju's (Think & Learn Pvt Ltd)"><option value="Unacademy (Sorting Hat Technologies)"><option value="PhysicsWallah (PhysicsWallah Pvt Ltd)"><option value="Vedantu (Vedantu Innovations Pvt Ltd)"><option value="UpGrad (UpGrad Education Pvt Ltd)"><option value="Simplilearn (Simplilearn Solutions Pvt Ltd)"><option value="Cuemath (CueLearn Pvt Ltd)">
                    <option value="IndiGo (InterGlobe Aviation Ltd)"><option value="Air India (Air India Ltd)"><option value="SpiceJet (SpiceJet Ltd)"><option value="Akasa Air (SNV Aviation Pvt Ltd)"><option value="Air India Express (Air India Express Ltd)">
                    <option value="Samsung India (Samsung India Electronics)"><option value="Apple India (Apple India Pvt Ltd)"><option value="Xiaomi India (Xiaomi Technology India)"><option value="OnePlus India (OPlus Mobitech India)"><option value="Dell India (Dell International Services)"><option value="HP India (HP India Sales Pvt Ltd)"><option value="Lenovo India (Lenovo India Pvt Ltd)"><option value="LG India (LG Electronics India Pvt Ltd)"><option value="Sony India (Sony India Pvt Ltd)"><option value="boAt Lifestyle (Imagine Marketing Ltd)"><option value="Urban Company (UrbanClap Technologies)">
<option value="National Cyber Crime Reporting Portal (MHA)"><option value="Meta Grievance Officer (Facebook/Instagram)"><option value="WhatsApp Grievance Officer"><option value="Google India Grievance Officer (YouTube/Search)"><option value="X (Twitter) Grievance Officer">
                </datalist>
                <div class="company-error" id="company_error">‚ö† Please select a verified company from the dropdown.</div>
            </div>

            <div class="input-group full-width">
                <label>Disputed Amount (‚Çπ)</label>
                <input type="number" id="disputed_amount" class="styled-input" placeholder="e.g. 5000" required>
            </div>

            <div class="input-group full-width">
                <label>Complaint Details</label>
                <textarea id="complaint_details" class="styled-textarea" placeholder="Briefly explain what went wrong. Be specific about dates and what was denied." required></textarea>
            </div>
        </div>

        <div class="consent-box">
            <input type="checkbox" id="legal_consent">
            <label for="legal_consent">
                I agree to the <a onclick="document.getElementById('tc_modal').style.display='flex'">Terms of Service & Privacy Policy</a>. I consent to Karma Claims securely storing my case details strictly for the purpose of tracking my 30-Day Consumer Court deadlines.
            </label>
        </div>

        <button class="btn-generate" id="submit_btn" onclick="generateDraft()">
            <div class="spinner" id="btn_spinner"></div>
            <span id="btn_text">Generate Formal Notice</span>
        </button>

        <div id="result_section">
            <h3 style="color: var(--primary); font-weight: 800;">Your Legal Package is Ready</h3>
            
            <div class="result-grid">
                
                <div class="result-main">
                    <div class="target-box">
                        <div class="target-info">To (Nodal Officer): <br><strong id="out_email">...</strong></div>
                        <div class="target-info">Subject Line: <br><strong id="out_subject">...</strong></div>
                    </div>

                    <div class="proof-warning">
                        ‚ö†Ô∏è CRITICAL STEP: You must MANUALLY attach your screenshots, receipts, and proofs on the next screen before you hit Send in your email client!
                    </div>

                    <div class="draft-box" id="out_body"></div>

                    <h4 style="color: var(--primary); margin-bottom: 10px;">Select your email provider to send:</h4>
                    <div class="mail-grid">
                        <button class="mail-btn gmail" id="gmail_btn">üî¥ Gmail</button>
                        <button class="mail-btn outlook" id="outlook_btn">üîµ Outlook</button>
                        <button class="mail-btn yahoo" id="yahoo_btn">üü£ Yahoo</button>
                        <button class="mail-btn apple" id="apple_btn">Ô£ø Apple / Default</button>
                    </div>
                    
                    <button class="copy-btn" onclick="copyDraft()">üìã Copy Draft to Clipboard</button>
                </div>

                <div class="fund-card">
                    <h3>‚òï Support Karma Claims</h3>
                    <p>Built by a solo founder fighting corporate impunity. Help us keep the servers running and the platform 100% free.</p>
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi%3A%2F%2Fpay%3Fpa%3Dss.aggarwal.17%40okaxis%26pn%3DKarma%2520Claims" alt="UPI QR Code" class="fund-qr">
                    <div class="fund-upi">ss.aggarwal.17@okaxis</div>
                </div>

            </div>
        </div>
    </div>

    <div class="dashboard-bridge">
        <a href="dashboard.html">
            üìä Open Active Case Dashboard <span>‚Üí</span>
        </a>
        <div class="bridge-sub">Track your deadlines, detect stalling tactics, and log your refunds.</div>
    </div>
</div>

<footer class="footer">
    <div class="footer-links">
        <a onclick="document.getElementById('contact_modal').style.display='flex'">Contact Us</a>
        <a onclick="document.getElementById('tc_modal').style.display='flex'">Terms & Conditions</a>
        <a onclick="document.getElementById('tc_modal').style.display='flex'">Privacy Policy</a>
        <a onclick="document.getElementById('contact_modal').style.display='flex'">Investor Relations</a>
    </div>
    <div class="footer-text">
        &copy; 2026 Karma Claims. All rights reserved.<br>
        Disclaimer: This platform provides AI-assisted legal formatting. It does not constitute formal legal counsel.
    </div>
</footer>

<div class="modal-overlay" id="tc_modal">
    <div class="modal-content">
        <button class="modal-close" onclick="document.getElementById('tc_modal').style.display='none'">√ó</button>
        <h2 class="modal-title">Terms of Service & Privacy Policy</h2>
        <div class="modal-text">
            <strong>1. Not Legal Advice</strong>
            <p>Karma Claims is an AI-powered drafting tool designed to structure grievances according to general Indian consumer protection frameworks. It does not provide formal legal counsel. Using this tool does not create an attorney-client relationship.</p>
            <br><strong>2. No Liability & User Responsibility</strong>
            <p>You are solely responsible for the accuracy of the claims made. The developers of Karma Claims cannot be held liable for any outcomes, lost funds, or corporate retaliation resulting from the use of the generated text.</p>
            <br><strong>3. Data Privacy & Secure Storage (DPDP Compliant)</strong>
            <p>To assist you with mandatory 30-day legal escalations (such as E-Daakhil filing), we securely store your email address, target company, and dispute amount in an encrypted, DPDP-compliant database. <strong>We do NOT store passwords, PINs, or raw image evidence.</strong> Any screenshots uploaded to the AI are temporarily processed in memory and instantly vaporized. This data is used exclusively to track your legal deadlines. You may request complete data deletion at any time by contacting support.</p>
        </div>
    </div>
</div>

<div class="modal-overlay" id="contact_modal">
    <div class="modal-content" style="text-align: center;">
        <button class="modal-close" onclick="document.getElementById('contact_modal').style.display='none'">√ó</button>
        <h2 class="modal-title">Contact Karma Claims</h2>
        <div class="modal-text">
            <p>Karma Claims is a bootstrapped legal-tech initiative dedicated to fighting corporate impunity.</p><br>
            <p><strong>For Consumer Support, Data Deletion Requests & Investor Relations:</strong><br>
            <span style="color: var(--secondary); font-size: 16px; font-weight: 600;">thesoverignsentinel@gmail.com</span></p><br>
            <p style="font-size: 12px; color: var(--text-muted); margin-top: 10px;">
                *(Note: Please do not send sensitive passwords or PINs to these email addresses)*
            </p>
        </div>
    </div>
</div>

<div id="ai_bubble" onclick="toggleTriageChat()" style="position: fixed; bottom: 30px; right: 30px; background: var(--accent); color: white; width: 64px; height: 64px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; cursor: pointer; box-shadow: 0 10px 25px rgba(220, 38, 38, 0.4); z-index: 1000; transition: transform 0.2s;">
    ‚öñÔ∏è
</div>

<div id="triage_chat_window" style="display: none; position: fixed; bottom: 105px; right: 30px; width: 360px; height: 480px; background: var(--surface); border-radius: 16px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); border: 1px solid var(--border); z-index: 1000; flex-direction: column; overflow: hidden; font-family: 'Inter', sans-serif;">
    <div style="background: var(--primary); color: white; padding: 16px; font-weight: 700; font-size: 15px; display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 8px;">
            <div style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%;"></div>
            Intake Copilot
        </div>
        <span onclick="toggleTriageChat()" style="cursor: pointer; font-size: 20px; line-height: 1;">√ó</span>
    </div>
    <div id="triage_chat_body" style="flex: 1; padding: 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; font-size: 14px; background: #f8fafc;">
        <div style="background: white; border: 1px solid var(--border); color: var(--text); padding: 12px; border-radius: 12px; border-bottom-left-radius: 4px; align-self: flex-start; max-width: 85%; line-height: 1.5;">
            Hi. I'm your Intake Paralegal. Type what happened or upload a screenshot of your order/receipt, and I'll extract the facts.
        </div>
    </div>
    
    <div id="triage_image_preview_container" style="display: none; padding: 10px 12px 0 12px; background: white; align-items: center; gap: 10px;">
        <span style="font-size: 12px; color: var(--text-muted); font-weight: 600;">Attachment:</span>
        <img id="triage_image_preview" style="height: 40px; border-radius: 4px; border: 1px solid var(--border);">
        <span onclick="clearTriageImage()" style="cursor: pointer; color: var(--accent); font-weight: bold; font-size: 14px;">‚úñ</span>
    </div>
    
    <div style="padding: 12px; background: white; border-top: 1px solid var(--border); display: flex; gap: 8px; align-items: center;">
        <input type="file" id="triage_file_upload" accept="image/*" style="display: none;" onchange="handleImageSelection()">
        <button onclick="document.getElementById('triage_file_upload').click()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-muted); padding: 5px;" title="Attach Proof">üìé</button>
        <input type="text" id="triage_input" placeholder="Type or attach proof..." style="flex: 1; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; outline: none; font-family: 'Inter';" onkeypress="if(event.key === 'Enter') sendTriageMessage()">
        <button onclick="sendTriageMessage()" style="background: var(--secondary); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">Send</button>
    </div>
</div>

<script>
    const API_BASE = "https://karma-claims-backend.onrender.com";

    function copyDraft() {
        const draftText = document.getElementById("out_body").innerText;
        navigator.clipboard.writeText(draftText).then(() => {
            alert("Draft successfully copied to your clipboard!");
        }).catch(err => alert("Failed to copy text."));
    }

    async function generateDraft() {
        const userInput = document.getElementById("target_company").value.trim();
        const datalistOptions = document.getElementById("company_db").options;
        const consent = document.getElementById("legal_consent").checked;
        const btn = document.getElementById("submit_btn");
        const btnText = document.getElementById("btn_text");
        const spinner = document.getElementById("btn_spinner");

        // Strict Validation (From V2.6)
        let isValid = Array.from(datalistOptions).some(opt => opt.value === userInput);
        if (!isValid) { document.getElementById("company_error").style.display = "block"; return; }
        document.getElementById("company_error").style.display = "none";
        
        if (!consent) { alert("Please accept the Terms of Service and Privacy Policy to continue."); return; }

        const payload = {
            user_name: document.getElementById("user_name").value.trim(),
            user_email: document.getElementById("user_email").value.trim(),
            user_phone: document.getElementById("user_phone").value.trim(),
            company_name: userInput,
            order_id: document.getElementById("order_id").value.trim(),
            disputed_amount: document.getElementById("disputed_amount").value.trim(),
            complaint_details: document.getElementById("complaint_details").value.trim()
        };

        if (!payload.user_name || !payload.order_id || !payload.complaint_details) {
            alert("Please fill in all required fields."); return;
        }

        btn.disabled = true; spinner.style.display = 'block'; btnText.innerText = 'Compiling Notice...';

        try {
            const response = await fetch(`${API_BASE}/generate-draft`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                const data = await response.json();
                
                // Display Results UI
                document.getElementById("result_section").style.display = "block";
                document.getElementById("out_email").innerText = data.target_email;
                document.getElementById("out_subject").innerText = data.subject;
                document.getElementById("out_body").innerText = data.draft;

                // Mailing System & Fallback Logic
                const bccEmail = "thesoverignsentinel@gmail.com";
                const safeBody = encodeURIComponent(data.draft);
                const safeSubject = encodeURIComponent(data.subject);
                const attachmentWarning = "‚ö†Ô∏è CRITICAL STEP:\n\nYou must MANUALLY attach your screenshots, receipts, and proofs on the next screen before you hit Send.\n\nClick OK to open your email app.";
                
                // 1. Mobile Device Detector
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

                // Heavy Notice Fallback
                if (safeBody.length > 7000) {
                    const heavyNotice = function () {
                        navigator.clipboard.writeText(data.draft).then(() => {
                            alert("‚ö†Ô∏è This legal notice is highly detailed and exceeds automatic email limits.\n\n‚úÖ It has been securely copied to your clipboard. Please open your mail app and paste it manually.");
                        });
                    };
                    document.getElementById("gmail_btn").onclick = heavyNotice;
                    document.getElementById("outlook_btn").onclick = heavyNotice;
                    document.getElementById("yahoo_btn").onclick = heavyNotice;
                    document.getElementById("apple_btn").onclick = heavyNotice;
                
                } else if (isMobile) {
                    // 2. MOBILE LOGIC: Force all buttons to use native OS Mail App
                    const mobileMailHandler = function () {
                        alert(attachmentWarning);
                        window.location.href = `mailto:${data.target_email}?bcc=${bccEmail}&subject=${safeSubject}&body=${safeBody}`;
                    };
                    document.getElementById("gmail_btn").onclick = mobileMailHandler;
                    document.getElementById("outlook_btn").onclick = mobileMailHandler;
                    document.getElementById("yahoo_btn").onclick = mobileMailHandler;
                    document.getElementById("apple_btn").onclick = mobileMailHandler;
                
                } else {
                    // 3. DESKTOP LOGIC: Use standard Webmail Links
                    document.getElementById("gmail_btn").onclick = function () {
                        alert(attachmentWarning);
                        window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${data.target_email}&bcc=${bccEmail}&su=${safeSubject}&body=${safeBody}`, '_blank');
                    };
                    document.getElementById("outlook_btn").onclick = function () {
                        alert(attachmentWarning);
                        window.open(`https://outlook.live.com/mail/0/deeplink/compose?to=${data.target_email}&bcc=${bccEmail}&subject=${safeSubject}&body=${safeBody}`, '_blank');
                    };
                    document.getElementById("yahoo_btn").onclick = function () {
                        alert(attachmentWarning);
                        window.open(`https://compose.mail.yahoo.com/?to=${data.target_email}&bcc=${bccEmail}&subject=${safeSubject}&body=${safeBody}`, '_blank');
                    };
                    document.getElementById("apple_btn").onclick = function () {
                        alert(attachmentWarning);
                        window.location.href = `mailto:${data.target_email}?bcc=${bccEmail}&subject=${safeSubject}&body=${safeBody}`;
                    };
                }

                document.getElementById("result_section").scrollIntoView({ behavior: "smooth", block: "start" });
            } else if (response.status === 422) {
                alert("Security Error: Please ensure all fields are filled out correctly without special code characters.");
            } else if (response.status === 429) {
                alert("Rate limit exceeded. Please wait a minute before generating another notice.");
            } else {
                alert("Server error. Please wait 30 seconds and try again.");
            }
        } catch (err) {
            alert("Network error. Ensure the server is online.");
        } finally {
            btn.disabled = false; spinner.style.display = 'none'; btnText.innerText = 'Generate Formal Notice';
        }
    }

    // --- AI INTAKE COPILOT LOGIC (With Vision Support) ---
    let triageHistory = [];
    let currentBase64Image = null;

    function toggleTriageChat() {
        const chat = document.getElementById('triage_chat_window');
        chat.style.display = chat.style.display === 'none' || chat.style.display === '' ? 'flex' : 'none';
        if (chat.style.display === 'flex') document.getElementById('triage_input').focus();
    }

    function handleImageSelection() {
        const file = document.getElementById('triage_file_upload').files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onloadend = function() {
            currentBase64Image = reader.result;
            document.getElementById('triage_image_preview').src = currentBase64Image;
            document.getElementById('triage_image_preview_container').style.display = 'flex';
        }
        reader.readAsDataURL(file);
    }

    function clearTriageImage() {
        currentBase64Image = null;
        document.getElementById('triage_file_upload').value = "";
        document.getElementById('triage_image_preview_container').style.display = 'none';
    }

    async function sendTriageMessage() {
        const input = document.getElementById('triage_input');
        const msg = input.value.trim();
        
        if (!msg && !currentBase64Image) return;

        const body = document.getElementById('triage_chat_body');
        
        let userMsgHtml = msg;
        if (currentBase64Image) {
            userMsgHtml = `<img src="${currentBase64Image}" style="max-width: 100%; border-radius: 8px; margin-bottom: 5px;"><br>` + msg;
        }

        body.innerHTML += `<div style="background: var(--secondary); color: white; padding: 12px; border-radius: 12px; border-bottom-right-radius: 4px; align-self: flex-end; max-width: 85%; line-height: 1.5;">${userMsgHtml}</div>`;
        input.value = '';
        body.scrollTop = body.scrollHeight;

        const payloadImage = currentBase64Image;
        clearTriageImage();

        const tid = 'typ-' + Date.now();
        body.innerHTML += `<div id="${tid}" style="background: white; border: 1px solid var(--border); padding: 12px; border-radius: 12px; border-bottom-left-radius: 4px; align-self: flex-start;">Typing...</div>`;
        body.scrollTop = body.scrollHeight;

        try {
            const res = await fetch(`${API_BASE}/api/triage-chat`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    user_message: msg, 
                    chat_history: triageHistory,
                    image_base64: payloadImage
                })
            });
            const d = await res.json();
            document.getElementById(tid)?.remove();
            
            // --- THE SAFETY CATCH ---
            const safeReply = d.reply || d.detail || d.error || "‚ö†Ô∏è The system is busy. Please try again in a moment.";
            
            if (d.status === "complete" && d.extracted_data) {
                body.innerHTML += `<div style="background: var(--success); color: white; padding: 12px; border-radius: 12px; align-self: flex-start; max-width: 85%;">üö® ${safeReply}</div>`;
                body.scrollTop = body.scrollHeight;
                
                const legalData = JSON.parse(d.extracted_data);
                document.getElementById('target_company').value = legalData.company_name || "";
                document.getElementById('user_name').value = legalData.user_name || "";
                document.getElementById('disputed_amount').value = (legalData.disputed_amount || "").replace(/\D/g,'') || "0";
                document.getElementById('order_id').value = legalData.order_id || "N/A";
                
                const autoReason = payloadImage ? "Auto-extracted from attached evidence: " : "Auto-extracted by AI Intake Copilot:\n\n";
                document.getElementById('complaint_details').value = autoReason + msg;
                document.getElementById('legal_consent').checked = true;
                
                setTimeout(() => {
                    toggleTriageChat();
                    generateDraft();
                }, 1500);
                
            } else {
                body.innerHTML += `<div style="background: white; border: 1px solid var(--border); color: var(--text); padding: 12px; border-radius: 12px; border-bottom-left-radius: 4px; align-self: flex-start; max-width: 85%; line-height: 1.5;">${safeReply}</div>`;
                
                // Only save to history if it was a real AI reply, not an error!
                if (d.reply) {
                    triageHistory.push({ role: "user", content: msg }, { role: "assistant", content: safeReply });
                }
            }
        } catch (e) {
            document.getElementById(tid)?.remove();
            body.innerHTML += `<div style="background: #fee2e2; color: #dc2626; padding: 12px; border-radius: 12px; align-self: flex-start;">‚ö†Ô∏è Connection error.</div>`;
        }
    }
    
    // --- SECURITY BOUNCER: Disable Right-Click and View Source ---
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.onkeydown = function(e) { 
        if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) || (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0))) { 
            return false; 
        } 
    };
</script>

</body>
</html>