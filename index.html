<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karma Claims | Formal Legal Notice Drafter</title>
    <style>
        :root {
            --primary: #1a365d;
            --secondary: #2563eb;
            --accent: #dc2626;
            --bg: #f8fafc;
            --surface: #ffffff;
            --border: #e2e8f0;
            --text: #0f172a;
            --text-muted: #64748b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

        body { background: var(--bg); color: var(--text); padding: 40px 20px; line-height: 1.5; }

        .wrapper { max-width: 800px; margin: 0 auto; display: flex; flex-direction: column; min-height: 90vh; }

        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 32px; color: var(--primary); margin-bottom: 8px; font-weight: 800; letter-spacing: -0.5px; }
        .header p { color: var(--text-muted); font-size: 15px; }

        .trust-bar { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 30px; padding: 12px; background: #eff6ff; border-radius: 6px; border: 1px solid #bfdbfe; font-size: 12px; font-weight: 600; color: #1e40af; }

        .panel { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 32px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); margin-bottom: 24px; }

        .field-group { margin-bottom: 20px; }
        .field-label { display: block; font-size: 13px; font-weight: 600; color: var(--primary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

        input, textarea { width: 100%; padding: 12px 16px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 15px; transition: border-color 0.2s; }
        input:focus, textarea:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        textarea { resize: vertical; min-height: 100px; }

        .company-error { display: none; font-size: 13px; color: var(--accent); margin-top: 8px; font-weight: 500; }

        .consent-row { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 24px; padding: 16px; background: #f8fafc; border: 1px solid var(--border); border-radius: 6px; }
        .consent-row input { width: 18px; height: 18px; margin-top: 2px; cursor: pointer; }
        .consent-text { font-size: 13px; color: var(--text-muted); }
        .consent-text a { color: var(--secondary); text-decoration: none; font-weight: 500; cursor: pointer; }

        .submit-btn { width: 100%; padding: 16px; background: var(--secondary); color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .submit-btn:hover { background: #1d4ed8; }
        .submit-btn:disabled { background: #94a3b8; cursor: not-allowed; }

        .loader { display: inline-block; width: 16px; height: 16px; border: 2px solid #ffffff; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite; vertical-align: middle; margin-right: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Result Section */
        .result-section { display: none; margin-top: 32px; }
        .result-grid { display: grid; grid-template-columns: 1fr 240px; gap: 24px; }
        
        @media (max-width: 650px) { .field-row, .result-grid { grid-template-columns: 1fr; } }

        .draft-box { background: #f8fafc; border: 1px solid var(--border); padding: 16px; border-radius: 6px; font-family: monospace; font-size: 13px; line-height: 1.6; color: #334155; height: 300px; overflow-y: auto; white-space: pre-wrap; margin-bottom: 16px; }

        .action-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 8px; }
        .action-btn.outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .action-btn.outline:hover { background: #f1f5f9; }

        .fund-card { border: 1px solid var(--border); border-radius: 8px; padding: 24px; text-align: center; background: white; }
        .fund-card h3 { color: var(--accent); font-size: 16px; margin-bottom: 8px; }
        .fund-card p { font-size: 13px; color: var(--text-muted); margin-bottom: 16px; }
        .fund-qr { width: 100%; max-width: 150px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 12px; }

        /* Corporate Footer */
        .footer { margin-top: auto; padding-top: 40px; text-align: center; font-size: 13px; color: var(--text-muted); }
        .footer-links { display: flex; justify-content: center; gap: 20px; margin-bottom: 12px; flex-wrap: wrap; }
        .footer-links a { color: var(--text-muted); text-decoration: none; transition: color 0.2s; cursor: pointer; }
        .footer-links a:hover { color: var(--secondary); }

        /* Modal Styling */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.7); align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(4px); }
        .modal-content { background: var(--surface); padding: 32px; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; border-bottom: 1px solid var(--border); padding-bottom: 16px; }
        .modal-header h2 { color: var(--primary); font-size: 20px; }
        .modal-close { cursor: pointer; font-weight: bold; color: var(--text-muted); font-size: 24px; line-height: 1; }
        .modal-close:hover { color: var(--accent); }
        .modal-body { font-size: 14px; color: var(--text); line-height: 1.6; }
        .modal-body strong { color: var(--primary); display: block; margin-top: 12px; }

    </style>
</head>
<body>

<div class="wrapper">
    <div class="header">
        <h1>Karma Claims</h1>
        <p>Generate formal, legally-routed grievance notices in seconds.</p>
    </div>

    <div class="trust-bar">
        <span>âœ“ RBI & TRAI Compliant</span>
        <span>âœ“ Zero Data Retention</span>
        <span>âœ“ 100% Free Tool</span>
    </div>

    <div class="panel">
        <div class="field-group">
            <label class="field-label">Target Entity</label>
            <input list="company_db" id="target_company" placeholder="Start typing company name..." required>
            <datalist id="company_db">
                <option value="HDFC Bank (HDFC Bank Limited)">
                <option value="SBI (State Bank of India)">
                <option value="ICICI Bank (ICICI Bank Ltd)">
                <option value="Axis Bank (Axis Bank Ltd)">
                <option value="Kotak Mahindra Bank">
                <option value="Punjab National Bank (PNB)">
                <option value="Bank of Baroda (BOB)">
                <option value="SBI Card (SBI Cards & Payment Services)">
                <option value="Google Pay (Google India Digital Services)">
                <option value="PhonePe (PhonePe Private Limited)">
                <option value="Paytm (One97 Communications Ltd)">
                <option value="CRED (Dreamplug Technologies Pvt Ltd)">
                <option value="Zerodha (Zerodha Broking Ltd)">
                <option value="Groww (Nextbillion Technology Pvt Ltd)">
                <option value="Upstox (RKSV Securities India Pvt Ltd)">
                
                <option value="Amazon India (Amazon Seller Services)">
                <option value="Flipkart (Flipkart Internet Pvt Ltd)">
                <option value="Myntra (Myntra Designs Pvt Ltd)">
                <option value="Meesho (Fashnear Technologies Pvt Ltd)">
                <option value="Nykaa (FSN E-Commerce Ventures Ltd)">
                <option value="Ajio (Reliance Retail Ltd)">
                <option value="Tata Cliq (Tata UniStore Limited)">
                
                <option value="Zomato (Zomato Limited)">
                <option value="Swiggy (Bundl Technologies Pvt Ltd)">
                <option value="Blinkit (Grofers India Pvt Ltd)">
                <option value="Zepto (Kiranakart Technologies Pvt Ltd)">
                <option value="BigBasket (Innovative Retail Concepts)">
                
                <option value="Ola Cabs (ANI Technologies Pvt Ltd)">
                <option value="Uber India (Uber India Systems Pvt Ltd)">
                <option value="Rapido (Roppen Transportation Services)">
                <option value="RedBus (Ibibo Group Pvt Ltd)">
                <option value="MakeMyTrip (MakeMyTrip India Pvt Ltd)">
                <option value="Goibibo (Ibibo Group Pvt Ltd)">
                <option value="Cleartrip (Cleartrip Pvt Ltd)">
                
                <option value="Indigo Airlines (InterGlobe Aviation)">
                <option value="Air India (Air India Limited)">
                <option value="SpiceJet (SpiceJet Limited)">
                <option value="Akasa Air (SNV Aviation Pvt Ltd)">
                
                <option value="Reliance Jio (Reliance Jio Infocomm)">
                <option value="Airtel (Bharti Airtel Limited)">
                <option value="Vi / Vodafone Idea (Vodafone Idea Ltd)">
                <option value="BSNL (Bharat Sanchar Nigam Limited)">
                <option value="Tata Play (Tata Play Limited)">
                <option value="LIC India (Life Insurance Corporation)">
                <option value="Star Health (Star Health & Allied Insurance)">
                <option value="HDFC Life (HDFC Life Insurance Co)">
                <option value="SBI Life (SBI Life Insurance Co)">
                <option value="Policybazaar (PB Fintech Ltd)">
                <option value="Acko (Acko General Insurance Ltd)">
                <option value="Byjus (Think and Learn Pvt Ltd)">
                <option value="Unacademy (Sorting Hat Technologies)">
                <option value="Physics Wallah (PhysicsWallah Pvt Ltd)">
                <option value="UpGrad (UpGrad Education Pvt Ltd)">
            </datalist>
            <div class="company-error" id="company_error">âš  Please select a verified company from the dropdown.</div>
        </div>

        <div class="field-row">
            <div class="field-group">
                <label class="field-label">Order / Transaction ID</label>
                <input type="text" id="order_id" placeholder="Reference number" required>
            </div>
            <div class="field-group">
                <label class="field-label">Disputed Amount (â‚¹)</label>
                <input type="number" id="disputed_amount" placeholder="0.00" required>
            </div>
        </div>

        <div class="field-group">
            <label class="field-label">Your Full Name</label>
            <input type="text" id="user_name" placeholder="E.g. Rahul Sharma" required>
        </div>

        <div class="field-row">
            <div class="field-group">
                <label class="field-label">Your Email</label>
                <input type="email" id="user_email" placeholder="consumer@domain.com" required>
            </div>
            <div class="field-group">
                <label class="field-label">Your Phone</label>
                <input type="tel" id="user_phone" placeholder="+91 XXXXX XXXXX" required>
            </div>
        </div>

        <div class="field-group">
            <label class="field-label">Incident Details</label>
            <textarea id="complaint_details" maxlength="1000" placeholder="Describe the fraud or dispute in detail. Be specific about dates and amounts..." required></textarea>
        </div>

        <div class="consent-row">
            <input type="checkbox" id="legal_consent" required>
            <div class="consent-text">
                I agree to the <a href="#" onclick="document.getElementById('terms_modal').style.display='flex'; return false;">Terms of Service</a>. I understand this is an AI drafting tool, not legal counsel, and I am not submitting sensitive passwords or PINs.
            </div>
        </div>

        <button class="submit-btn" id="submit_btn" onclick="generateDraft()">
            <span id="btn_text">Generate Formal Notice</span>
        </button>
    </div>

    <div class="result-section" id="result_section">
        <div class="result-grid">
            <div class="panel" style="margin-bottom: 0;">
                <div class="field-group">
                    <label class="field-label">To: <span id="out_email" style="color: var(--text); font-weight: 400; text-transform: none;"></span></label>
                    <label class="field-label">Subject: <span id="out_subject" style="color: var(--text); font-weight: 400; text-transform: none;"></span></label>
                </div>
                <div class="draft-box" id="out_body"></div>
                
                <label class="field-label" style="margin-top: 20px;">Send Notice Via:</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                    <button class="action-btn" id="gmail_btn" style="background-color: #ea4335; margin: 0;">ðŸ”´ Gmail</button>
                    <button class="action-btn" id="outlook_btn" style="background-color: #0078d4; margin: 0;">ðŸ”µ Outlook</button>
                    <button class="action-btn" id="yahoo_btn" style="background-color: #6001d2; margin: 0;">ðŸŸ£ Yahoo</button>
                    <button class="action-btn" id="apple_btn" style="background-color: #000000; margin: 0;">ï£¿ Apple / Default</button>
                </div>
                <button class="action-btn outline" onclick="copyDraft()" style="margin: 0;">Copy Draft to Clipboard</button>
            </div>

            <div class="fund-card">
                <h3>Fund the Fight</h3>
                <p>Karma Claims is a solo movement fighting corporate impunity. Help us keep servers running.</p>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=ss.aggarwal.17@okaxis&pn=KarmaClaims&cu=INR" alt="UPI QR" class="fund-qr">
                <label class="field-label" style="text-align: center;">Scan to Fund</label>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="footer-links">
            <a href="#" onclick="document.getElementById('contact_modal').style.display='flex'; return false;">Investor Relations</a>
            <a href="#" onclick="document.getElementById('contact_modal').style.display='flex'; return false;">Contact Us</a>
            <a href="#" onclick="document.getElementById('terms_modal').style.display='flex'; return false;">Privacy Policy</a>
            <a href="#" onclick="document.getElementById('terms_modal').style.display='flex'; return false;">Terms of Service</a>
        </div>
        <p>Â© 2026 Karma Claims. All rights reserved.</p>
    </div>
</div>

<div class="modal-overlay" id="terms_modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Terms of Service & Disclaimer</h2>
            <span class="modal-close" onclick="document.getElementById('terms_modal').style.display='none'">&times;</span>
        </div>
        <div class="modal-body">
            <strong>1. Not Legal Advice</strong>
            <p>Karma Claims is an AI-powered drafting tool, not a law firm. The notices generated are for your personal use and do not constitute official legal counsel.</p>
            
            <strong>2. Data Privacy & Zero Retention</strong>
            <p>We do not store your personal data, transaction IDs, or generated notices on our servers after your session ends. Your data is processed securely and immediately discarded.</p>
            
            <strong>3. User Responsibility</strong>
            <p>You are solely responsible for the accuracy of the claims made and the validity of the evidence provided to the target entity.</p>
            
            <button class="action-btn" style="margin-top: 24px;" onclick="document.getElementById('terms_modal').style.display='none'">I Understand & Agree</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="contact_modal">
    <div class="modal-content" style="text-align: center;">
        <div class="modal-header">
            <h2>Contact Karma Claims</h2>
            <span class="modal-close" onclick="document.getElementById('contact_modal').style.display='none'">&times;</span>
        </div>
        <div class="modal-body">
            <p>Karma Claims is a bootstrapped legal-tech initiative dedicated to fighting corporate impunity.</p><br>
            
            <p><strong>For Consumer Support:</strong><br>
            <span style="color: var(--secondary); font-size: 16px; font-weight: 500;">thesoverignsentinel@gmail.com</span></p><br>
            
            <p><strong>For Press & Investor Relations:</strong><br>
            <span style="color: var(--secondary); font-size: 16px; font-weight: 500;">thesoverignsentinel@gmail.com</span></p><br>
            
            <p style="font-size: 12px; color: var(--text-muted); margin-top: 10px;">
                *(Note: Please do not send sensitive passwords or PINs to these email addresses)*
            </p>
            
            <button class="action-btn" style="margin-top: 24px;" onclick="document.getElementById('contact_modal').style.display='none'">Close Window</button>
        </div>
    </div>
</div>

<script>
function copyDraft() {
    const draftText = document.getElementById("out_body").innerText;
    navigator.clipboard.writeText(draftText).then(() => {
        alert("Draft successfully copied to your clipboard!");
    }).catch(err => alert("Failed to copy text."));
}

async function generateDraft() {
    const userInput = document.getElementById("target_company").value;
    const datalistOptions = document.getElementById("company_db").options;
    const consent = document.getElementById("legal_consent").checked;
    const btn = document.getElementById("submit_btn");
    const btnText = document.getElementById("btn_text");

    let isValid = Array.from(datalistOptions).some(opt => opt.value === userInput);

    if (!isValid) { document.getElementById("company_error").style.display = "block"; return; }
    if (!consent) { alert("Please accept the Terms of Service to continue."); return; }

    document.getElementById("company_error").style.display = "none";
    btn.disabled = true;
    btnText.innerHTML = '<span class="loader"></span> Compiling Notice...';

    const payload = {
        user_name: document.getElementById("user_name").value,
        company_name: userInput,
        order_id: document.getElementById("order_id").value,
        disputed_amount: document.getElementById("disputed_amount").value,
        user_email: document.getElementById("user_email").value,
        user_phone: document.getElementById("user_phone").value,
        complaint_details: document.getElementById("complaint_details").value
    };

    try {
        // LOCAL TESTING URL IS SET HERE (Update this before going live)
        const response = await fetch("https://karma-claims-backend.onrender.com/generate-draft", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (response.ok) {
            const data = await response.json();
            document.getElementById("result_section").style.display = "block";
            document.getElementById("out_email").innerText = data.target_email;
            document.getElementById("out_subject").innerText = data.subject;
            document.getElementById("out_body").innerText = data.body;

            // UPDATED BCC EMAIL
            const bccEmail = "thesoverignsentinel@gmail.com";
            
            const safeBody = encodeURIComponent(data.body);
            const safeSubject = encodeURIComponent(data.subject);
            const attachmentWarning = "âš ï¸ CRITICAL STEP:\n\nYou must MANUALLY attach your screenshots, receipts, and proofs on the next screen before you hit Send.\n\nClick OK to open your email.";
            
            if (safeBody.length > 7000) {
                const heavyNotice = function () {
                    navigator.clipboard.writeText(data.body).then(() => {
                        alert("âš ï¸ This legal notice is highly detailed and exceeds automatic email limits.\n\nâœ… It has been securely copied to your clipboard. Please open your mail app and paste it.");
                    });
                };
                
                document.getElementById("gmail_btn").onclick = heavyNotice;
                document.getElementById("outlook_btn").onclick = heavyNotice;
                document.getElementById("yahoo_btn").onclick = heavyNotice;
                document.getElementById("apple_btn").onclick = heavyNotice;
                
            } else {
                document.getElementById("gmail_btn").onclick = function () {
                    alert(attachmentWarning);
                    window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${data.target_email}&bcc=${bccEmail}&su=${safeSubject}&body=${safeBody}`, '_blank');
                };

                document.getElementById("outlook_btn").onclick = function () {
                    alert(attachmentWarning);
                    window.open(`https://outlook.live.com/owa/?path=/mail/action/compose&to=${data.target_email}&subject=${safeSubject}&body=${safeBody}`, '_blank');
                };

                document.getElementById("yahoo_btn").onclick = function () {
                    alert(attachmentWarning);
                    window.open(`https://compose.mail.yahoo.com/?to=${data.target_email}&subject=${safeSubject}&body=${safeBody}`, '_blank');
                };

                document.getElementById("apple_btn").onclick = function () {
                    alert(attachmentWarning);
                    window.location.href = `mailto:${data.target_email}?bcc=${bccEmail}&subject=${safeSubject}&body=${safeBody}`;
                };
            }

            document.getElementById("result_section").scrollIntoView({ behavior: "smooth", block: "start" });
        } else if (response.status === 422) {
            alert("Security Error: Please ensure all fields are filled out correctly.");
        } else if (response.status === 429) {
            alert("Rate limit exceeded. Please wait a minute before generating another notice.");
        } else {
            alert("Server error. Please wait 30 seconds and try again.");
        }
    } catch (err) {
        alert("Network error. Ensure your local server is running.");
    } finally {
        btn.disabled = false;
        btnText.innerHTML = 'Generate Formal Notice';
    }
}

// --- SECURITY BOUNCER: Disable Right-Click and View Source ---
document.addEventListener('contextmenu', event => event.preventDefault());
document.onkeydown = function(e) { 
    if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) || (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0))) { 
        return false; 
    } 
};
</script>

</body>
</html>